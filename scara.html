<!DOCTYPE html>
<html lang="en">
<head>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5LNLJSG1BE"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-5LNLJSG1BE');
    </script>

    <title>Michał Batsch Portfolio</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,500;0,600;0,700;0,800;0,900;1,400&display=swap"
          rel="stylesheet">
    <link rel="Stylesheet" type="text/css" href="styles.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script type="text/javascript" id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/mml-chtml.js"></script>

    <link rel="stylesheet" href="https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css">
</head>
<body>

<section>
    <nav>

        <div style="border-bottom: 1px solid #c4c4c4;"><img src="files/photo2.png" alt="Photo" class="img1"></div>
        <div style="border-bottom: 1px solid #c4c4c4; padding-right: 20px; padding-left: 20px;">

            <h_name>Michał</h_name>
            <br>
            <h1>Batsch</h1><br>
            <h_big_blue>PhD, Eng.</h_big_blue>

        </div>
        <div style="padding-right: 20px; padding-left: 20px;">
            <ul>
                <li><h3>About me</h3></li>

                <!--<info class="info"></info>-->

                <p style="text-align: left;">I am a research scientist with over ten years of experience in scientific programming and computations including image and signal processing, machine learning and neural networks. As a problem-solving-oriented person with the ability to understand complicated mathematical models and a strong mechanical engineering background, I&nbsp am ready to dive into a data-driven world as a data scientist/data analyst.</p>

                <h3>Contact</h3>
                <li><i class="fa fa-linkedin-square" style="color: #0447ff;"></i>&nbsp<a
                        href="https://www.linkedin.com/in/michal-batsch">LinkedIn</a>
                </li>
                <li><i class="fa fa-github-square" style="color: #0447ff;"></i>&nbsp<a
                        href="https://github.com/mbatsch">GitHub</a></li>
                <li><i class="ai ai-researchgate-square" style="color: #0447ff;"></i>&nbsp<a
                        href="https://www.researchgate.net/profile/Michal-Batsch-2">ResearchGate</a></li>
            </ul>
        </div>
    </nav>
    <article>
        <div align="left"><a href="index.html">&#8592; Back to projects</a></div>
        <h1>Vision based control of small educational double SCARA robot</h1>
        <h2>Used tools and packages</h2>
        <span>Python</span> <span>OpenCV</span> <span>TensorFlow</span> <span>Scikit-learn</span>
        <span>NumPy</span> <span>Scipy</span> <span>C</span> <span>RaspberryPI</span> <span>Matlab</span>

        <h2>Introduction</h2>

        <p>This project aimed to develop an easy-to-build and deploy educational robot, which may be used during classes
            to study machine vision-based control and classification. This was achieved by a double SCARA structure
            driven by two stepper motors controlled by RaspberryPI Zero. The 3D CAD model of the designed manipulator is
            shown below:</p>

        <img src="files/scara1.png" alt="Double SCARA robot" class="img2">

        <p>As the gripper the electromagnet is used which may manipulate objects into one from selected boxes attached.
            The camera is observing the working area of the manipulator. Control of the position of the tool center
            point (TCP) is realized with the aid of inverse kinematics:</p>

        <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
            <mtable rowspacing="4pt" columnspacing="1em">
                <mtr>
                    <mtd>
                        <msub>
                            <mi>φ</mi>
                            <mi>R</mi>
                        </msub>
                        <mo>=</mo>
                        <mrow class="MJX-TeXAtom-ORD">
                            <mtext>atan2</mtext>
                        </mrow>
                        <mo stretchy="false">(</mo>
                        <msub>
                            <mi>y</mi>
                            <mrow class="MJX-TeXAtom-ORD">
                                <mi>T</mi>
                                <mi>C</mi>
                                <mi>P</mi>
                            </mrow>
                        </msub>
                        <mo>,</mo>
                        <msub>
                            <mi>x</mi>
                            <mrow class="MJX-TeXAtom-ORD">
                                <mi>T</mi>
                                <mi>C</mi>
                                <mi>P</mi>
                            </mrow>
                        </msub>
                        <mo>−</mo>
                        <mi>e</mi>
                        <mo stretchy="false">)</mo>
                        <mo>−</mo>
                        <mrow class="MJX-TeXAtom-ORD">
                            <mtext>acos</mtext>
                        </mrow>
                        <mfrac>
                            <mrow>
                                <mo stretchy="false">(</mo>
                                <msub>
                                    <mi>x</mi>
                                    <mrow class="MJX-TeXAtom-ORD">
                                        <mi>T</mi>
                                        <mi>C</mi>
                                        <mi>P</mi>
                                    </mrow>
                                </msub>
                                <mo>−</mo>
                                <mi>e</mi>
                                <msup>
                                    <mo stretchy="false">)</mo>
                                    <mn>2</mn>
                                </msup>
                                <mo>+</mo>
                                <msubsup>
                                    <mi>y</mi>
                                    <mrow class="MJX-TeXAtom-ORD">
                                        <mi>T</mi>
                                        <mi>C</mi>
                                        <mi>P</mi>
                                    </mrow>
                                    <mn>2</mn>
                                </msubsup>
                                <mo>+</mo>
                                <msubsup>
                                    <mi>l</mi>
                                    <mn>1</mn>
                                    <mn>2</mn>
                                </msubsup>
                                <mo>−</mo>
                                <msubsup>
                                    <mi>l</mi>
                                    <mn>2</mn>
                                    <mn>2</mn>
                                </msubsup>
                            </mrow>
                            <mrow>
                                <mn>2</mn>
                                <msub>
                                    <mi>l</mi>
                                    <mn>1</mn>
                                </msub>
                                <msqrt>
                                    <mo stretchy="false">(</mo>
                                    <msub>
                                        <mi>x</mi>
                                        <mrow class="MJX-TeXAtom-ORD">
                                            <mi>T</mi>
                                            <mi>C</mi>
                                            <mi>P</mi>
                                        </mrow>
                                    </msub>
                                    <mo>−</mo>
                                    <mi>e</mi>
                                    <msup>
                                        <mo stretchy="false">)</mo>
                                        <mn>2</mn>
                                    </msup>
                                    <mo>+</mo>
                                    <msubsup>
                                        <mi>y</mi>
                                        <mrow class="MJX-TeXAtom-ORD">
                                            <mi>T</mi>
                                            <mi>C</mi>
                                            <mi>P</mi>
                                        </mrow>
                                        <mn>2</mn>
                                    </msubsup>
                                </msqrt>
                            </mrow>
                        </mfrac>
                    </mtd>
                </mtr>
                <mtr>
                    <mtd>
                        <msub>
                            <mi>φ</mi>
                            <mi>L</mi>
                        </msub>
                        <mo>=</mo>
                        <mrow class="MJX-TeXAtom-ORD">
                            <mtext>atan2</mtext>
                        </mrow>
                        <mo stretchy="false">(</mo>
                        <msub>
                            <mi>y</mi>
                            <mrow class="MJX-TeXAtom-ORD">
                                <mi>T</mi>
                                <mi>C</mi>
                                <mi>P</mi>
                            </mrow>
                        </msub>
                        <mo>,</mo>
                        <msub>
                            <mi>x</mi>
                            <mrow class="MJX-TeXAtom-ORD">
                                <mi>T</mi>
                                <mi>C</mi>
                                <mi>P</mi>
                            </mrow>
                        </msub>
                        <mo>+</mo>
                        <mi>e</mi>
                        <mo stretchy="false">)</mo>
                        <mo>+</mo>
                        <mrow class="MJX-TeXAtom-ORD">
                            <mtext>acos</mtext>
                        </mrow>
                        <mfrac>
                            <mrow>
                                <mo stretchy="false">(</mo>
                                <msub>
                                    <mi>x</mi>
                                    <mrow class="MJX-TeXAtom-ORD">
                                        <mi>T</mi>
                                        <mi>C</mi>
                                        <mi>P</mi>
                                    </mrow>
                                </msub>
                                <mo>+</mo>
                                <mi>e</mi>
                                <msup>
                                    <mo stretchy="false">)</mo>
                                    <mn>2</mn>
                                </msup>
                                <mo>+</mo>
                                <msubsup>
                                    <mi>y</mi>
                                    <mrow class="MJX-TeXAtom-ORD">
                                        <mi>T</mi>
                                        <mi>C</mi>
                                        <mi>P</mi>
                                    </mrow>
                                    <mn>2</mn>
                                </msubsup>
                                <mo>+</mo>
                                <msubsup>
                                    <mi>l</mi>
                                    <mn>1</mn>
                                    <mn>2</mn>
                                </msubsup>
                                <mo>−</mo>
                                <msubsup>
                                    <mi>l</mi>
                                    <mn>2</mn>
                                    <mn>2</mn>
                                </msubsup>
                            </mrow>
                            <mrow>
                                <mn>2</mn>
                                <msub>
                                    <mi>l</mi>
                                    <mn>1</mn>
                                </msub>
                                <msqrt>
                                    <mo stretchy="false">(</mo>
                                    <msub>
                                        <mi>x</mi>
                                        <mrow class="MJX-TeXAtom-ORD">
                                            <mi>T</mi>
                                            <mi>C</mi>
                                            <mi>P</mi>
                                        </mrow>
                                    </msub>
                                    <mo>+</mo>
                                    <mi>e</mi>
                                    <msup>
                                        <mo stretchy="false">)</mo>
                                        <mn>2</mn>
                                    </msup>
                                    <mo>+</mo>
                                    <msubsup>
                                        <mi>y</mi>
                                        <mrow class="MJX-TeXAtom-ORD">
                                            <mi>T</mi>
                                            <mi>C</mi>
                                            <mi>P</mi>
                                        </mrow>
                                        <mn>2</mn>
                                    </msubsup>
                                </msqrt>
                            </mrow>
                        </mfrac>
                    </mtd>
                </mtr>
            </mtable>
        </math>

        <p>Manipulator parts were manufactured with the aid of 3D printing. The camera may provide information about the
            position of TCP and object location. For that purpose, the calibration needs to be performed:</p>

        <img src="files/scara2.png" alt="Calibration" class="img2">
        <p>In that way one may obtain, based on the image coordinates the coordinates in the real working area:</p>

        <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
            <mtable rowspacing="4pt" columnspacing="1em">
                <mtr>
                    <mtd>
                        <msub>
                            <mi>s</mi>
                            <mi>c</mi>
                        </msub>
                        <mo>=</mo>
                        <mfrac>
                            <mn>100</mn>
                            <mn>415</mn>
                        </mfrac>
                        <mrow class="MJX-TeXAtom-ORD">
                            <mtext>px/mm</mtext>
                        </mrow>
                    </mtd>
                </mtr>
                <mtr>
                    <mtd>
                        <msub>
                            <mi>v</mi>
                            <mi>x</mi>
                        </msub>
                        <mo>=</mo>
                        <mn>340</mn>
                        <msub>
                            <mi>s</mi>
                            <mi>c</mi>
                        </msub>
                    </mtd>
                </mtr>
                <mtr>
                    <mtd>
                        <msub>
                            <mi>v</mi>
                            <mi>y</mi>
                        </msub>
                        <mo>=</mo>
                        <mn>212</mn>
                        <msub>
                            <mi>s</mi>
                            <mi>c</mi>
                        </msub>
                    </mtd>
                </mtr>
                <mtr>
                    <mtd>
                        <msub>
                            <mi>t</mi>
                            <mi>y</mi>
                        </msub>
                        <mo>=</mo>
                        <mn>95</mn>
                        <mrow class="MJX-TeXAtom-ORD">
                            <mtext>mm</mtext>
                        </mrow>
                    </mtd>
                </mtr>
                <mtr>
                    <mtd>
                        <mi>x</mi>
                        <mo>=</mo>
                        <msub>
                            <mi>x</mi>
                            <mrow class="MJX-TeXAtom-ORD">
                                <mi>i</mi>
                                <mi>m</mi>
                            </mrow>
                        </msub>
                        <msub>
                            <mi>s</mi>
                            <mi>c</mi>
                        </msub>
                        <mo>−</mo>
                        <msub>
                            <mi>v</mi>
                            <mi>x</mi>
                        </msub>
                    </mtd>
                </mtr>
                <mtr>
                    <mtd>
                        <mi>y</mi>
                        <mo>=</mo>
                        <mo>−</mo>
                        <msub>
                            <mi>y</mi>
                            <mrow class="MJX-TeXAtom-ORD">
                                <mi>i</mi>
                                <mi>m</mi>
                            </mrow>
                        </msub>

                        <msub>
                            <mi>s</mi>
                            <mi>c</mi>
                        </msub>
                        <mo>+</mo>
                        <msub>
                            <mi>v</mi>
                            <mi>y</mi>
                        </msub>
                        <mo>+</mo>
                        <msub>
                            <mi>t</mi>
                            <mi>y</mi>
                        </msub>
                    </mtd>
                </mtr>
            </mtable>
        </math>

        <p>Object detection may be realized with OpenCV hblob analysis. Next, the location of each object within the
            image is used to calculate the position in the working area and to handle parts in the proper box.</p>

        <h2>Image classification</h2>

        <p>The proposed educational stand may be used for image recognition and classification. As an example, the small
            steel galvanized parts are used, which part of them have surface defects:</p>

        <img src="files/scara4.png" alt="Classified parts" class="img2">

        <p>This is a real industrial problem occurring in mass production which should be handled by an automatic system
            of
            inspection. The previously described object detection method may be used for data collection:</p>

        <img src="files/scara5.png" alt="Data acquisition" class="img2">

        <p>Acquired data consists of 307 bad and 307 good images the size of which is 90px x 90px randomly located
            within the working
            area. Next, to increase the number of images, data augmentation was performed. Each of the images was rotated about an angle of 90⁰, 180⁰ and 270⁰. This resulted in a total number of colour images of 2456 of size 90px x 90px each. The dataset was split into data for training (60%), validation (20%) and testing (20%) which gives respectively 1476, 490 and 490 images. In each of these subsets, the distribution of features (defect/no defect) is equal (50%/50%). Before training, images were subjected to pre-processing, namely zero-centering with respect to the training dataset and converting into BGR images. These data are then used to train, validate and test neural network schematically shown below:</p>

        <img src="files/scara_network.png" alt="Classified parts" class="img2">

        <p>The network consists of two convolutional 2D layers with 3x3 kernel and rectified linear unit activation function followed by max pooling layers with pool size 2x2. In the end, the output after pooling is flattened and returned after the dense layer with softmax activation as the probability of class occurrence. The training was performed with Adam optimizer and as the loss the categorical cross-entropy was used. The results of testing are shown as confusion matrix below:</p>

        <img src="files/scara_cm.png" alt="Confusion matrix" class="img3">

        <p>Sometimes we have to deal with heavily imbalanced datasets with a small number of data corresponding to the failure state. It is common in various diagnostics tasks where we do not have extensive test results and we only know how the system should perform in normal operation. In such cases, there is a need for the use of an unsupervised or semi-supervised learning approach. To simulate this situation we will use part of our dataset.  For training and validation, we will use only images of parts without defects. Testing will be performed with both defect and no defect images. This results in 738 (100% without defect) images for training, 245 (100% without defect) for validation and 490 (50% defective / 50% without defect) for testing. To decrease the training time we applied different pre-processing. Images were resized to 28px x 28px, transformed into greyscale and normalized.</p>
        <p>One of the typical applications of the unsupervised learning approach is anomaly detection. There are various anomaly detection methods, and one of them is to use of an autoencoder. An autoencoder is a special type of neural network designed to reconstruct its input. It might be used for dimensionality reduction and feature extraction. Input data are compressed by the encoder into the latent layer and then decoded by the decoder. Anomaly might be detected by analysis of latent space or reconstruction error. Figure below presents a convolutional autoencoder used for the detection of abnormal images in this study.</p>

        <img src="files/scara_ae.png" alt="Convolutional autoencoder" class="img2">

        <p>The encoder consists of five convolutional 2D layers with a rectified linear unit activation function and two max pooling layers. The decoder is constructed from five up-sampling transposed convolutional layers. While training, Adam optimizer with the loss as the mean squared error was used. Training and validation loss converges to small value of approx. 0.15. The result of reconstruction of training data is presented below:</p>

        <img src="files/scara_rec.png" alt="Reconstructions" class="img3">

        <p>To visualise the results we may transform latent space into three-dimensional space with the aid of T-distributed stochastic neighbour embedding (t-SNE), which is shown below:</p>

        <img src="files/scara_tsne.png" alt="tSNE of latent space" class="img2">

        <p>After embedding the latent image data, a centred cluster corresponding to parts without defects is observed. Points for parts with defects are spread around this centre cluster. To detect whenever a point is within the blue cluster the k-means algorithm can be used. We assume that only blue points are known, which forms one cluster (k=1). Then we calculate the average of these points which corresponds to the cluster center. In the case presented center coordinates are near zero (t<sub>SNE1</sub>=-0.15,  t<sub>SNE2</sub>=0.23, t<sub>SNE3</sub>=-0.04). Next, we calculate the distance of each blue point to the cluster centre and average them, which gives us the limiting distance (r<sub>lim</sub>=17.58). The point is considered an outlier if its distance to the cluster centre is greater than rlim. Otherwise, we assume that it is located within this cluster. The results of k-means-based classification are given below:</p>

        <img src="files/scara_results.png" alt="Results of unsupervised classification" class="img2">

        <h2>Summary</h2>

        <p>Presented educational stand may be successfully used for courses on:
        <p>
        <ul>
            <li>deep learning in machine vision,
            </li>
            <li>classification
            </li>
            <li>object tracking and detection,
            </li>
            <li>
                vision-based control.
            </li>
        </ul>

        <div>
            <a href="index.html">&#8592; Back to projects</a>&nbsp&nbsp&nbsp<a href="#">&#8593; Back on top</a>
        </div>
    </article>
</section>

</body>
</html>

